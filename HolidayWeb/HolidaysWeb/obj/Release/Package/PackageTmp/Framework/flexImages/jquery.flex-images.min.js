(function(n){function t(n,r,u,f){function w(n){u.maxRows&&y>u.maxRows||u.truncate&&n?o[e][0].hide():(o[e][5]&&(o[e][4].attr("src",o[e][5]),o[e][5]=""),o[e][0].css({width:s,height:p}).show())}var e,s,l=1,y=1,c=n.width(),o=[],a=0,p=u.rowHeight,v;for(i=0;i<r.length;i++)if(o.push(r[i]),v=parseInt(c/3),u.rowHeight=v,a+=v+u.margin,a>=c){for(l=c/a,p=Math.ceil(u.rowHeight*l),exact_w=0,s,e=0;e<o.length;e++)o[e][3]=v,s=Math.ceil(o[e][3]*l),exact_w+=s+u.margin,exact_w>c&&(s-=exact_w-c+1),w();o=[];a=0;y++}for(e=0;e<o.length;e++)s=Math.floor(o[e][3]*l),h=Math.floor(u.rowHeight*l),w(!0);f||c==n.width()||t(n,r,u,!0)}n.fn.flexImages=function(i){var r=n.extend({container:".item",object:"img",rowHeight:180,maxRows:0,truncate:!1},i);return this.each(function(){var i=n(this),f=n(r.container,i),u=[],e=f.eq(0),o=(new Date).getTime(),s=i.width();r.margin=e.outerWidth(!0)-e.innerWidth();f.each(function(){var t=parseInt(n(this).data("w")),i=parseInt(n(this).data("h")),e=t*(r.rowHeight/i),f=n(this).find(r.object);u.push([n(this),t,i,e,f,f.data("src")])});t(i,u,r);n(window).off("resize.flexImages"+i.data("flex-t"));n(window).on("resize.flexImages"+o,function(){t(i,u,r)});i.data("flex-t",o)})}})(jQuery);